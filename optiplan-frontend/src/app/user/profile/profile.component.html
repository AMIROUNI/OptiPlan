<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">Loading profile...</div>

  <!-- Header Section -->
  <div class="profile-header" *ngIf="!isLoading">
    <div class="cover-photo"></div>
    <div class="profile-info">
      <div class="avatar-container">
        <img [src]="profile?.avatarUrl || 'assets/default-avatar.png'" alt="Profile" class="avatar">
        <div class="profile-badge" *ngIf="isMyProfile">
          <span class="badge-icon">üë§</span>
          <span>My Profile</span>
        </div>
      </div>
      
      <div class="profile-actions">
        <button *ngIf="isMyProfile" class="btn btn-primary" (click)="toggleEdit()">
          <span class="action-icon">{{ isEditing ? 'üíæ' : '‚úèÔ∏è' }}</span>
          {{ isEditing ? 'Save Profile' : 'Edit Profile' }}
        </button>
        
        <button *ngIf="!isMyProfile" class="btn btn-primary" (click)="openMessageForm()">
          <span class="action-icon">‚úâÔ∏è</span>
          Message
        </button>
        
        <button *ngIf="!isMyProfile" class="btn btn-secondary">
          <span class="action-icon">ü§ù</span>
          Connect
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="profile-content" *ngIf="!isLoading">
    <!-- Left Column -->
    <div class="profile-details">
      <div class="profile-card">
        <div class="profile-intro">
          <h1>{{ profile?.fullName || 'No name provided' }}</h1>
          <p class="title">{{ profile?.jobTitle || 'No title provided' }}</p>
          <div class="location" *ngIf="profile?.country">
            <span class="location-icon">üìç</span>
            <span>{{ profile?.country }}</span>
          </div>
        </div>

        <!-- About Section -->
        <form [formGroup]="profileForm">
          <div class="section">
            <h2><span class="section-icon">üë§</span> About</h2>
            <div *ngIf="!isEditing">
              <p class="bio">{{ profile?.bio || 'No bio provided' }}</p>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="bio">Bio</label>
                <textarea class="form-control" id="bio" formControlName="bio" rows="4"></textarea>
              </div>
            </div>
          </div>

          <!-- Work Section -->
          <div class="section">
            <h2><span class="section-icon">üíº</span> Work</h2>
            <div *ngIf="!isEditing">
              <div class="info-grid">
                <div class="info-item" *ngIf="profile?.companyName">
                  <span class="info-icon">üè¢</span>
                  <div>
                    <h3>Company</h3>
                    <p>{{ profile?.companyName }}</p>
                  </div>
                </div>
                <div class="info-item" *ngIf="profile?.department">
                  <span class="info-icon">üë•</span>
                  <div>
                    <h3>Department</h3>
                    <p>{{ profile?.department }}</p>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="companyName">Company</label>
                <input type="text" class="form-control" id="companyName" formControlName="companyName">
              </div>
              <div class="form-group">
                <label for="department">Department</label>
                <input type="text" class="form-control" id="department" formControlName="department">
              </div>
            </div>
          </div>

          <!-- Contact Section -->
          <div class="section">
            <h2><span class="section-icon">üì±</span> Contact</h2>
            <div *ngIf="!isEditing && profile?.phoneNumber">
              <p>{{ profile?.phoneNumber }}</p>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="phoneNumber">Phone</label>
                <input type="tel" class="form-control" id="phoneNumber" formControlName="phoneNumber">
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Right Column -->
    <div class="profile-sidebar">
      <!-- Skills Card -->
      <div class="skills-card">
        <div class="card-header">
          <h2><span class="header-icon">üíª</span> Skills</h2>
          <button *ngIf="isMyProfile" class="btn btn-icon" (click)="addSkill()">
            <span class="action-icon">‚ûï</span>
          </button>
        </div>

        <!-- Add Skill Form -->
        <form [formGroup]="newSkillForm" *ngIf="showSkillForm && isMyProfile" class="add-skill-form">
          <div class="form-group">
            <label for="skillName">Skill Name</label>
            <input type="text" class="form-control" id="skillName" placeholder="Skill name" formControlName="name">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Proficiency</label>
              <div class="rating">
                <span *ngFor="let star of [1,2,3,4,5,6,7,8,9,10]" 
                      (click)="newSkillForm.get('proficiencyLevel')?.setValue(star)"
                      [class.active]="star <= newSkillForm.get('proficiencyLevel')?.value">
                  ‚òÖ
                </span>
              </div>
            </div>
            <div class="form-group">
              <label for="yearsExperience">Years</label>
              <input type="number" class="form-control" id="yearsExperience" formControlName="yearsExperience" min="1">
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelAddSkill()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="saveNewSkill()">Save</button>
          </div>
        </form>

        <!-- Skills List -->
        <div class="skills-list">
          <div class="skill-item" *ngFor="let skill of profile?.skills">
            <div class="skill-info">
              <h3>{{ skill.name }}</h3>
              <div class="skill-meta">
                <span>{{ skill.yearsExperience }} year{{ skill.yearsExperience > 1 ? 's' : '' }}</span>
                <div class="stars">
                  <span *ngFor="let star of getProficiencyStars(skill.proficiencyLevel)">‚òÖ</span>
                  <span *ngFor="let star of getEmptyStars(skill.proficiencyLevel)">‚òÜ</span>
                </div>
              </div>
            </div>
            <button *ngIf="isMyProfile" class="btn btn-icon btn-danger" (click)="deleteSkill(skill.id)">
              <span class="action-icon">üóëÔ∏è</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message Modal -->
  <div class="message-modal" *ngIf="showMessageForm">
    <div class="modal-content">
      <button class="close-btn" (click)="closeMessageForm()">
        <span class="action-icon">‚úñÔ∏è</span>
      </button>
      
      <h2>Send Message</h2>
      
      <div *ngIf="messageSent" class="success-message">
        <p>Your message has been sent successfully!</p>
      </div>
      
      <form *ngIf="!messageSent" [formGroup]="messageForm" (ngSubmit)="sendMessage()">
        <div class="form-group">
          <label for="subject">Subject</label>
          <input type="text" class="form-control" id="subject" formControlName="subject">
        </div>
        <div class="form-group">
          <label for="content">Message</label>
          <textarea class="form-control" id="content" formControlName="content" rows="5"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeMessageForm()">Cancel</button>
          <button type="submit" class="btn btn-primary">Send <span class="action-icon">‚úâÔ∏è</span></button>
        </div>
      </form>
    </div>
  </div>
</div>