<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- Header Section -->
  <div class="profile-header" *ngIf="!isLoading">
    <div class="cover-photo">
      <img [src]="profile?.backGround || 'assets/default-backGround.png'" alt="Cover Photo">
    </div>
    <div class="profile-info">
      <div class="avatar-container">
        <img [src]="profile?.avatarUrl || 'assets/default-avatar.png'" alt="Profile Avatar" class="avatar">
        <div class="profile-badge" *ngIf="isMyProfile">
          <span>My Profile</span>
        </div>
      </div>
      <div class="profile-actions">
        <button *ngIf="isMyProfile" class="btn btn-primary" (click)="toggleEdit()">
          {{ isEditing ? 'Save Profile' : 'Edit Profile' }}
        </button>
        <button *ngIf="!isMyProfile" class="btn btn-primary" (click)="openChat()">
          Message
        </button>
        <button *ngIf="!isMyProfile" class="btn btn-secondary">
          Connect
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="profile-content" *ngIf="!isLoading">
    <!-- Left Column -->
    <div class="profile-details">
      <div class="profile-card">
        <div class="profile-intro">
          <h1>{{ profile?.fullName || 'No name provided' }}</h1>
          <p class="title">{{ profile?.jobTitle || 'No title provided' }}</p>
          <p class="location" *ngIf="profile?.country">
            {{ profile?.country }}
          </p>
        </div>

        <!-- About Section -->
        <form [formGroup]="profileForm">
          <div class="section">
            <h2>About</h2>
            <div *ngIf="!isEditing">
              <p class="bio">{{ profile?.bio || 'No bio provided' }}</p>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="bio">Bio</label>
                <textarea class="form-control" id="bio" formControlName="bio" rows="4"></textarea>
              </div>
            </div>
          </div>

          <!-- Work Section -->
          <div class="section">
            <h2>Work</h2>
            <div *ngIf="!isEditing">
              <div class="info-grid">
                <div class="info-item" *ngIf="profile?.companyName">
                  <h3>Company</h3>
                  <p>{{ profile?.companyName }}</p>
                </div>
                <div class="info-item" *ngIf="profile?.department">
                  <h3>Department</h3>
                  <p>{{ profile?.department }}</p>
                </div>
              </div>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="companyName">Company</label>
                <input type="text" class="form-control" id="companyName" formControlName="companyName">
              </div>
              <div class="form-group">
                <label for="department">Department</label>
                <input type="text" class="form-control" id="department" formControlName="department">
              </div>
            </div>
          </div>

          <!-- Contact Section -->
          <div class="section">
            <h2>Contact</h2>
            <div *ngIf="!isEditing && profile?.phoneNumber">
              <p>{{ profile?.phoneNumber }}</p>
            </div>
            <div *ngIf="isEditing">
              <div class="form-group">
                <label for="phoneNumber">Phone</label>
                <input type="tel" class="form-control" id="phoneNumber" formControlName="phoneNumber">
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Right Column -->
    <div class="profile-sidebar">
      <!-- Skills Card -->
      <div class="skills-card">
        <div class="card-header">
          <h2>Skills</h2>
          <button *ngIf="isMyProfile" class="btn btn-icon" (click)="addSkill()">
            Add
          </button>
        </div>

        <!-- Add Skill Form -->
        <form [formGroup]="newSkillForm" *ngIf="showSkillForm && isMyProfile" class="add-skill-form">
          <div class="form-group">
            <label for="skillName">Skill Name</label>
            <input type="text" class="form-control" id="skillName" formControlName="name">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Proficiency</label>
              <div class="rating">
                <span *ngFor="let star of [1,2,3,4,5]" 
                      (click)="newSkillForm.get('proficiencyLevel')?.setValue(star)"
                      [class.active]="star <= newSkillForm.get('proficiencyLevel')?.value">
                  ★
                </span>
              </div>
            </div>
            <div class="form-group">
              <label for="yearsExperience">Years</label>
              <input type="number" class="form-control" id="yearsExperience" formControlName="yearsExperience" min="1">
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancelAddSkill()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="saveNewSkill()">Save</button>
          </div>
        </form>

        <!-- Skills List -->
        <div class="skills-list">
          <div class="skill-item" *ngFor="let skill of profile?.skills">
            <div class="skill-info">
              <h3>{{ skill.name }}</h3>
              <div class="skill-meta">
                <span>{{ skill.yearsExperience }} year{{ skill.yearsExperience > 1 ? 's' : '' }}</span>
                <div class="stars">
                  <span *ngFor="let star of getProficiencyStars(skill.proficiencyLevel)">★</span>
                  <span *ngFor="let star of getEmptyStars(skill.proficiencyLevel)">☆</span>
                </div>
              </div>
            </div>
            <button *ngIf="isMyProfile" class="btn btn-icon btn-danger" (click)="deleteSkill(skill.id)">
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container" *ngIf="showChat">
    <div class="chat-header">
      <h3>Chat with {{ profile?.fullName || 'User' }}</h3>
      <button class="close-btn" (click)="closeChat()">✖</button>
    </div>
    <app-chat-box [selectedUserUsername]="username"
    [selectedUserId]="selectedUserId"></app-chat-box>
  </div>
</div>