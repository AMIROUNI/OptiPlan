<div class="jira-workitem-container">
  <!-- Navigation Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>OptiPlan</h3>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li [class.active]="activeView === 'board'">
          <a (click)="activeView = 'board'">
            <i class="bi bi-kanban"></i> Board
          </a>
        </li>
        <li [class.active]="activeView === 'backlog'">
          <a (click)="activeView = 'backlog'">
            <i class="bi bi-list-ul"></i> Backlog
          </a>
        </li>
        <li [class.active]="activeView === 'reports'">
          <a (click)="activeView = 'reports'">
            <i class="bi bi-bar-chart"></i> Reports
          </a>
        </li>
        <li class="divider"></li>
        <li>
          <a>
            <i class="bi bi-gear"></i> Project Settings
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Header -->
    <div class="content-header">
      <div class="header-left">
        <h2>{{project?.name || 'Project'}}</h2>
        <div class="project-key">PROJ-{{project?.id?.substring(0, 4)}}</div>
      </div>
      <div class="header-right">
        <button class="btn btn-primary" (click)="openCreateModal()">
          <i class="bi bi-plus-lg"></i> Create
        </button>
      </div>
    </div>

    <!-- View Tabs -->
    <div class="view-tabs">
      <div class="tabs-container">
        <div class="tab" [class.active]="activeView === 'board'" (click)="activeView = 'board'">
          <i class="bi bi-kanban"></i> Board
        </div>
        <div class="tab" [class.active]="activeView === 'backlog'" (click)="activeView = 'backlog'">
          <i class="bi bi-list-ul"></i> Backlog
        </div>
        <div class="tab" [class.active]="activeView === 'reports'" (click)="activeView = 'reports'">
          <i class="bi bi-bar-chart"></i> Reports
        </div>
      </div>
    </div>

    <!-- Board View -->
    <div *ngIf="activeView === 'board'" class="board-view">
      <div class="board-columns">
        <div class="board-column" *ngFor="let status of statuses" 
             droppable 
             (dragover)="onDragOver($event)" 
             (drop)="onDrop(status, $event)">
          <div class="column-header">
            <h3>{{status | titlecase}}</h3>
            <span class="badge">{{getWorkItemsByStatus(status).length}}</span>
          </div>
          <div class="column-content">
            <div class="workitem-card" 
                 *ngFor="let item of getWorkItemsByStatus(status)" 
                 draggable="true"
                 (dragstart)="onDragStart(item)"
                 (click)="openDetailModal(item)">
              <div class="card-header">
                <span class="item-key">{{item.type | slice:0:1}}-{{item.id.substring(0, 4)}}</span>
                <span class="item-type" [ngClass]="'type-' + item.type.toLowerCase()">
                  {{item.type}}
                </span>
              </div>
              <div class="card-title">
                {{item.title}}
              </div>
              <div class="card-footer">
                <div class="item-priority" [ngClass]="'priority-' + item.priority.toLowerCase()">
                  <i [class]="getPriorityIcon(item.priority)"></i>
                </div>
                <div class="item-estimate" *ngIf="item.estimatedHours">
                  {{item.estimatedHours}}h
                </div>
                <div class="item-assignee" *ngIf="item.assignedUser">
                  <img [src]="item.assignedUser.avatarUrl || 'assets/default-avatar.png'" 
                       [alt]="item.assignedUser.username" 
                       class="avatar">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Backlog View -->
    <div *ngIf="activeView === 'backlog'" class="backlog-view">
      <div class="backlog-header">
        <div class="backlog-filters">
          <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" placeholder="Search backlog..." [(ngModel)]="searchQuery">
          </div>
          <div class="filter-buttons">
            <button class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-filter"></i> Filter
            </button>
            <button class="btn btn-sm btn-outline-secondary">
              <i class="bi bi-list-check"></i> Display
            </button>
          </div>
        </div>
      </div>

      <div class="backlog-content">
        <table class="backlog-table">
          <thead>
            <tr>
              <th width="40px"></th>
              <th width="100px">Key</th>
              <th>Summary</th>
              <th width="120px">Type</th>
              <th width="120px">Priority</th>
              <th width="120px">Status</th>
              <th width="100px">Assignee</th>
              <th width="80px">Estimate</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of filteredWorkItems" class="backlog-item" (click)="openDetailModal(item)">
              <td>
                <i class="bi bi-grip-vertical drag-handle"></i>
              </td>
              <td class="item-key">{{item.type | slice:0:1}}-{{item.id.substring(0, 4)}}</td>
              <td class="item-summary">
                <a>{{item.title}}</a>
                <div class="item-labels" *ngIf="item.labels">
                  <span *ngFor="let label of item.labels.split(',')" class="badge">{{label.trim()}}</span>
                </div>
              </td>
              <td>
                <span class="item-type" [ngClass]="'type-' + item.type.toLowerCase()">
                  {{item.type}}
                </span>
              </td>
              <td>
                <span class="item-priority" [ngClass]="'priority-' + item.priority.toLowerCase()">
                  <i [class]="getPriorityIcon(item.priority)"></i> {{item.priority}}
                </span>
              </td>
              <td>
                <span class="item-status" [ngClass]="'status-' + item.status.toLowerCase()">
                  {{item.status}}
                </span>
              </td>
              <td class="item-assignee">
                <img *ngIf="item.assignedUser" 
                     [src]="item.assignedUser.avatarUrl || 'assets/default-avatar.png'" 
                     [alt]="item.assignedUser.username" 
                     class="avatar">
              </td>
              <td class="item-estimate">
                {{item.estimatedHours || '-'}}h
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Reports View -->
    <div *ngIf="activeView === 'reports'" class="reports-view">
      <div class="report-card">
        <h3>Sprint Burndown</h3>
        <div class="chart-placeholder">
          <i class="bi bi-bar-chart"></i>
          <p>Burndown chart will appear here</p>
        </div>
      </div>
      <div class="report-card">
        <h3>Work Item Distribution</h3>
        <div class="chart-placeholder">
          <i class="bi bi-pie-chart"></i>
          <p>Pie chart will appear here</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Work Item Modal -->
  <ng-template #createModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Create Work Item</h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="workItemForm" (ngSubmit)="createWorkItem()">
        <div class="form-group">
          <label>Type</label>
          <select class="form-select" formControlName="type" (change)="onTypeChange()">
            <option *ngFor="let type of workItemTypes" [value]="type">{{type}}</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Title</label>
          <input type="text" class="form-control" formControlName="title" placeholder="Enter title">
        </div>
        
        <div class="form-group">
          <label>Description</label>
          <textarea class="form-control" formControlName="description" rows="3" placeholder="Enter description"></textarea>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label>Priority</label>
              <select class="form-select" formControlName="priority">
                <option *ngFor="let priority of priorities" [value]="priority">{{priority}}</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label>Status</label>
              <select class="form-select" formControlName="status">
                <option *ngFor="let status of statuses" [value]="status">{{status}}</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="row" *ngIf="workItemForm.value.type === 'Story' || workItemForm.value.type === 'Epic'">
          <div class="col-md-6">
            <div class="form-group">
              <label>Story Points</label>
              <input type="number" class="form-control" formControlName="storyPoints" min="1">
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label>Estimated Hours</label>
              <input type="number" class="form-control" formControlName="estimatedHours" min="1">
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label>Due Date</label>
              <input type="date" class="form-control" formControlName="dueDate">
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Labels (comma separated)</label>
          <input type="text" class="form-control" formControlName="labels" placeholder="bug,ui,backend">
        </div>
        
        <div class="form-group">
          <label>Assignee</label>
          <select class="form-select" formControlName="assignedUserId">
            <option value="">Unassigned</option>
            <option *ngFor="let user of teamMembers" [value]="user.id">{{user.name}}</option>
          </select>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="workItemForm.invalid">
            Create
          </button>
        </div>
      </form>
    </div>
  </ng-template>

  <!-- Work Item Detail Modal -->
  <ng-template #detailModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">{{selectedWorkItem?.type}}-{{selectedWorkItem?.id?.substring(0, 4)}}</h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <div *ngIf="selectedWorkItem" class="workitem-detail">
        <div class="detail-header">
          <h3>{{selectedWorkItem.title}}</h3>
          <div class="detail-meta">
            <span class="item-type" [ngClass]="'type-' + selectedWorkItem.type.toLowerCase()">
              {{selectedWorkItem.type}}
            </span>
            <span class="item-status" [ngClass]="'status-' + selectedWorkItem.status.toLowerCase()">
              {{selectedWorkItem.status}}
            </span>
          </div>
        </div>
        
        <div class="detail-content">
          <div class="detail-description">
            <h4>Description</h4>
            <p>{{selectedWorkItem.description || 'No description provided'}}</p>
          </div>
          
          <div class="detail-properties">
            <div class="property">
              <label>Priority</label>
              <span class="item-priority" [ngClass]="'priority-' + selectedWorkItem.priority.toLowerCase()">
                <i [class]="getPriorityIcon(selectedWorkItem.priority)"></i> {{selectedWorkItem.priority}}
              </span>
            </div>
            
            <div class="property">
              <label>Assignee</label>
              <div class="assignee" *ngIf="selectedWorkItem.assignedUser">
                <img [src]="selectedWorkItem.assignedUser.avatarUrl || 'assets/default-avatar.png'" 
                     [alt]="selectedWorkItem.assignedUser.username" 
                     class="avatar">
                <span>{{selectedWorkItem.assignedUser.username}}</span>
              </div>
              <span *ngIf="!selectedWorkItem.assignedUser">Unassigned</span>
            </div>
            
            <div class="property">
              <label>Reporter</label>
              <div class="assignee" *ngIf="selectedWorkItem.reporter">
                <img [src]="selectedWorkItem.reporter.avatarUrl || 'assets/default-avatar.png'" 
                     [alt]="selectedWorkItem.reporter.username" 
                     class="avatar">
                <span>{{selectedWorkItem.reporter.username}}</span>
              </div>
            </div>
            
            <div class="property">
              <label>Created</label>
              <span>{{selectedWorkItem.createdAt | date}}</span>
            </div>
            
            <div class="property">
              <label>Due Date</label>
              <span>{{selectedWorkItem.dueDate ? (selectedWorkItem.dueDate | date) : 'No due date'}}</span>
            </div>
            
            <div class="property">
              <label>Estimated Hours</label>
              <span>{{selectedWorkItem.estimatedHours || '-'}}h</span>
            </div>
            
            <div class="property" *ngIf="selectedWorkItem.type === 'Story' || selectedWorkItem.type === 'Epic'">
              <label>Story Points</label>
              <span>{{selectedWorkItem.storyPoints || '-'}}</span>
            </div>
            
            <div class="property">
              <label>Labels</label>
              <div class="labels" *ngIf="selectedWorkItem.labels">
                <span *ngFor="let label of selectedWorkItem.labels.split(',')" class="badge">{{label.trim()}}</span>
              </div>
              <span *ngIf="!selectedWorkItem.labels">No labels</span>
            </div>
          </div>
        </div>
        
        <div class="detail-tabs">
          <div class="tabs-container">
            <div class="tab active">
              <i class="bi bi-chat-left-text"></i> Comments
            </div>
            <div class="tab">
              <i class="bi bi-paperclip"></i> Attachments
            </div>
            <div class="tab">
              <i class="bi bi-clock-history"></i> History
            </div>
          </div>
          
          <div class="tab-content">
            <div class="comment-section">
              <div class="comment-list">
                <div *ngFor="let comment of selectedWorkItem.comments" class="comment">
                  <div class="comment-author">
                    <img [src]="comment.author?.avatarUrl || 'assets/default-avatar.png'" 
                         [alt]="comment.author?.username" 
                         class="avatar">
                    <div class="author-info">
                      <strong>{{comment.author?.username}}</strong>
                      <small>{{comment.createdAt | date:'short'}}</small>
                    </div>
                  </div>
                  <div class="comment-text">
                    {{comment.content}}
                  </div>
                </div>
              </div>
              <div class="comment-form">
                <textarea placeholder="Add a comment..." rows="3"></textarea>
                <button class="btn btn-primary">Comment</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</div>