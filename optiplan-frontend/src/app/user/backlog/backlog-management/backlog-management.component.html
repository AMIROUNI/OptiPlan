<div class="jira-backlog-container">
  <!-- Header Section -->
  <div class="backlog-header">
    <div class="header-top">
      <div class="header-title">
        <h1>
          <i class="bi bi-list-task"></i>
          <span>Project Backlog</span>
        </h1>
        <div class="header-actions">
          <button class="btn btn-primary" (click)="openTaskModal()">
            <i class="bi bi-plus-lg"></i> Create
          </button>
          <div class="view-switcher">
            <button class="btn btn-outline-secondary" [class.active]="activeTab === 'backlog'" (click)="activeTab = 'backlog'">
              <i class="bi bi-list-ul"></i> Backlog
            </button>
            <button class="btn btn-outline-secondary" [class.active]="activeTab === 'sprints'" (click)="activeTab = 'sprints'">
              <i class="bi bi-rocket"></i> Sprints
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="header-filters">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input type="text" placeholder="Search backlog...">
      </div>
      <div class="filter-buttons">
        <button class="btn btn-sm btn-outline-secondary">
          <i class="bi bi-filter"></i> Filter
        </button>
        <button class="btn btn-sm btn-outline-secondary">
          <i class="bi bi-list-check"></i> Display
        </button>
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="backlog-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner-border text-primary" role="status"></div>
      <p>Loading your backlog...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger">
      <i class="bi bi-exclamation-triangle-fill"></i>
      {{ error }}
    </div>

    <!-- Backlog View -->
    <div *ngIf="activeTab === 'backlog' && !loading && !error">
      <!-- Backlog Issues -->
      <div class="issues-container">
        <div class="issues-header">
          <div class="issues-count">
            {{ backlogTasks.length }} issues
          </div>
          <div class="issues-view-options">
            <button class="btn btn-sm btn-outline-secondary" [class.active]="viewMode === 'list'" (click)="viewMode = 'list'">
              <i class="bi bi-list-ul"></i> List
            </button>
            <button class="btn btn-sm btn-outline-secondary" [class.active]="viewMode === 'board'" (click)="viewMode = 'board'">
              <i class="bi bi-kanban"></i> Board
            </button>
          </div>
        </div>

        <!-- List View -->
        <div *ngIf="viewMode === 'list'" class="issues-list">
          <table class="table">
            <thead>
              <tr>
                <th width="40px"></th>
                <th width="60px">Key</th>
                <th>Summary</th>
                <th width="120px">Type</th>
                <th width="120px">Priority</th>
                <th width="120px">Status</th>
                <th width="100px">Estimate</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let task of backlogTasks" class="issue-row">
                <td>
                  <i class="bi bi-grip-vertical drag-handle"></i>
                </td>
                <td class="issue-key">PROJ-{{ task.id }}</td>
                <td class="issue-summary">
                  <a href="#">{{ task.title }}</a>
                  <div class="issue-labels">
                    <span *ngFor="let label of task.labels" class="badge bg-light text-dark">{{ label }}</span>
                  </div>
                </td>
                <td>
                  <span class="issue-type" [ngClass]="'type-' + task.type.toLowerCase()">
                    <i [class]="getTypeIcon(task.type)"></i> {{ task.type }}
                  </span>
                </td>
                <td>
                  <span class="issue-priority" [ngClass]="'priority-' + task.priority.toLowerCase()">
                    <i [class]="getPriorityIcon(task.priority)"></i> {{ task.priority }}
                  </span>
                </td>
                <td>
                  <span class="issue-status" [ngClass]="'status-' + task.status.toLowerCase()">
                    {{ task.status }}
                  </span>
                </td>
                <td class="issue-estimate">
                  {{ task.estimatedHours }}h
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Board View -->
        <div *ngIf="viewMode === 'board'" class="issues-board">
          <div class="board-columns">
            <div class="board-column" *ngFor="let status of ['ToDo', 'InProgress', 'InReview', 'Done']">
              <div class="column-header">
                <h5>{{ status }}</h5>
                <span class="badge bg-secondary">{{ getFilteredTasks(status).length }}</span>
              </div>
              <div class="column-content" 
                   droppable 
                   (dragover)="onDragOver($event)" 
                   (drop)="onDrop(status, $event)">
                <div class="issue-card" 
                     *ngFor="let task of getFilteredTasks(status)" 
                     draggable="true"
                     (dragstart)="onDragStart(task)">
                  <div class="card-header">
                    <span class="issue-key">PROJ-{{ task.id }}</span>
                    <span class="issue-type" [ngClass]="'type-' + task.type.toLowerCase()">
                      <i [class]="getTypeIcon(task.type)"></i>
                    </span>
                  </div>
                  <div class="card-summary">
                    <a href="#">{{ task.title }}</a>
                  </div>
                  <div class="card-footer">
                    <span class="issue-priority" [ngClass]="'priority-' + task.priority.toLowerCase()">
                      <i [class]="getPriorityIcon(task.priority)"></i>
                    </span>
                    <span class="issue-estimate">{{ task.estimatedHours }}h</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sprints View -->
    <div *ngIf="activeTab === 'sprints' && !loading && !error" class="sprints-view">
      <!-- Active Sprint -->
      <div class="sprint-section">
        <h3 class="section-title">Active Sprint</h3>
        <div *ngIf="activeSprint; else noActiveSprint" class="sprint-card active">
          <div class="sprint-header">
            <div class="sprint-title">
              <h4>{{ activeSprint.name }}</h4>
              <span class="badge bg-success">Active</span>
            </div>
            <div class="sprint-dates">
              {{ activeSprint.startDate | date }} - {{ activeSprint.endDate | date }}
            </div>
          </div>
          <div class="sprint-progress">
            <div class="progress">
              <div class="progress-bar" 
                   [style.width]="getSprintCompletionPercentage() + '%'">
                {{ getSprintCompletionPercentage() }}%
              </div>
            </div>
          </div>
          <div class="sprint-actions">
            <button class="btn btn-sm btn-outline-primary">View Board</button>
            <button class="btn btn-sm btn-outline-secondary">Complete Sprint</button>
          </div>
        </div>
        <ng-template #noActiveSprint>
          <div class="empty-state">
            <i class="bi bi-calendar-x"></i>
            <p>No active sprint currently running</p>
            <button class="btn btn-primary" (click)="openSprintModal()">
              <i class="bi bi-plus-lg"></i> Create Sprint
            </button>
          </div>
        </ng-template>
      </div>

      <!-- Future Sprints -->
      <div class="sprint-section">
        <h3 class="section-title">Future Sprints</h3>
        <div *ngIf="getFutureSprints().length > 0; else noFutureSprints" class="sprint-list">
          <div *ngFor="let sprint of getFutureSprints()" class="sprint-card future">
            <div class="sprint-header">
              <div class="sprint-title">
                <h5>{{ sprint.name }}</h5>
                <span class="badge bg-info">Planned</span>
              </div>
              <div class="sprint-dates">
                {{ sprint.startDate | date }} - {{ sprint.endDate | date }}
              </div>
            </div>
            <div class="sprint-actions">
              <button class="btn btn-sm btn-outline-primary">Start Sprint</button>
            </div>
          </div>
        </div>
        <ng-template #noFutureSprints>
          <div class="empty-state">
            <i class="bi bi-calendar-plus"></i>
            <p>No future sprints planned</p>
          </div>
        </ng-template>
      </div>

      <!-- Past Sprints -->
      <div class="sprint-section">
        <h3 class="section-title">Past Sprints</h3>
        <div *ngIf="getCompletedSprints().length > 0; else noPastSprints" class="sprint-list">
          <div *ngFor="let sprint of getCompletedSprints()" class="sprint-card past">
            <div class="sprint-header">
              <div class="sprint-title">
                <h5>{{ sprint.name }}</h5>
                <span class="badge bg-secondary">Completed</span>
              </div>
              <div class="sprint-dates">
                {{ sprint.startDate | date }} - {{ sprint.endDate | date }}
              </div>
            </div>
            <div class="sprint-progress">
              <div class="progress">
                <div class="progress-bar bg-success" 
                     [style.width]="getSprintCompletionPercentage(sprint) + '%'"></div>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noPastSprints>
          <div class="empty-state">
            <i class="bi bi-calendar-check"></i>
            <p>No past sprints found</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Add Task Modal -->
  <ng-template #addTaskModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Create issue</h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <app-add-task [projectId]="projectId" 
                   (taskCreated)="handleTaskCreated($event)" 
                   (cancel)="modal.dismiss()">
      </app-add-task>
    </div>
  </ng-template>

  <!-- Add Sprint Modal -->
  <ng-template #addSprintModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Create sprint</h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <app-add-sprint [projectId]="projectId" 
                     (sprintCreated)="handleSprintCreated($event)" 
                     (cancel)="modal.dismiss()">
      </app-add-sprint>
    </div>
  </ng-template>
</div>